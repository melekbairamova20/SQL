//
create table Customers( 
    customer_id NUMBER GENERATED by default as identity primary key, 
    first_name VARCHAR2(50) not null, 
    last_name VARCHAR2(50) not null, 
    phone_number VARCHAR2(20) not null unique, 
    email VARCHAR2(100) not null unique, 
    date_of_bithday DATE 
);

create table Rooms( 
    room_id NUMBER GENERATED by default as identity primary key, 
    room_type VARCHAR2(30) not null, 
    price_per_night NUMBER(10, 2), 
    status VARCHAR2(10) check (status in ('available', 'booked')) 
);

create table Reservations( 
    reservation_id NUMBER GENERATED by default as identity primary key, 
    customer_id NUMBER references Rooms(room_id), 
    check_in_date DATE, 
    check_out_date DATE 
);

create table Employees ( 
    employee_id NUMBER GENERATED by default as identity primary key, 
    first_name VARCHAR2(50) not null, 
    last_name VARCHAR2(50) not null, 
    position VARCHAR2(30) not null, 
    phone_number VARCHAR2(20) not null unique 
);

create table Payments ( 
    payment_id NUMBER GENERATED by default as identity primary key, 
    reservation_id NUMBER references Reservations(reservation_id), 
    amount NUMBER(10, 2), 
    payment_date DATE 
);

create table Services ( 
    service_id NUMBER GENERATED by default as identity primary key, 
    service_name VARCHAR2(50) not null, 
    price NUMBER(10, 2) 
);

create table Reservation_Services ( 
    reservation_service_id NUMBER GENERATED by default as identity primary key, 
    reservation_id NUMBER references Reservations(reservation_id), 
    service_id NUMBER references Services(service_id), 
    quantity NUMBER default 1 
);

create table Check_In_Out( 
    log_id number generated by default as identity primary key, 
    customer_id number references Customers(customer_id), 
    room_id number references Rooms(room_id), 
    check_in date, 
    check_out date 
);

create table Reservation_History( 
    history_id number generated by default as identity primary key, 
    reservation_id number references Reservations(reservation_id), 
    status varchar2(20) check(status in ('booked', 'canceled', 'completed')), 
    update_date date 
);

CREATE TABLE Discounts ( 
    discount_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, 
    discount_code VARCHAR2(20) not null unique, 
    discount_percentage NUMBER(3, 2), 
    start_date DATE, 
    end_date DATE 
);

CREATE TABLE Room_Types ( 
    room_type_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, 
    room_type_name VARCHAR2(30) not null, 
    description VARCHAR2(200) not null, 
    base_price NUMBER(10, 2) 
);

CREATE TABLE Stay_Duration ( 
    stay_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, 
    customer_id NUMBER REFERENCES Customers(customer_id), 
    room_id NUMBER REFERENCES Rooms(room_id), 
    check_in_date DATE, 
    check_out_date DATE, 
    total_days NUMBER 
);

INSERT INTO Customers (first_name, last_name, phone_number, email, date_of_bithday)
VALUES ('John', 'Doe', '555-123456', 'john.doe@example.com', TO_DATE('1985-06-15', 'YYYY-MM-DD'));
INSERT INTO Customers (first_name, last_name, phone_number, email, date_of_bithday)
VALUES ('Jane', 'Smith', '555-654321', 'jane.smith@example.com', TO_DATE('1990-12-30', 'YYYY-MM-DD'));
INSERT INTO Customers (first_name, last_name, phone_number, email, date_of_bithday)
VALUES ('Michael', 'Johnson', '555-111222', 'michael.johnson@example.com', TO_DATE('1982-02-10', 'YYYY-MM-DD'));
INSERT INTO Customers (first_name, last_name, phone_number, email, date_of_bithday)
VALUES ('Emily', 'Davis', '555-777888', 'emily.davis@example.com', TO_DATE('1995-07-20', 'YYYY-MM-DD'));
INSERT INTO Customers (first_name, last_name, phone_number, email, date_of_bithday)
VALUES ('William', 'Brown', '555-999555', 'william.brown@example.com', TO_DATE('1988-11-12', 'YYYY-MM-DD'));

select * from Customers;

INSERT INTO Rooms (room_type, price_per_night, status)
VALUES ('Single', 100.00, 'available');
INSERT INTO Rooms (room_type, price_per_night, status)
VALUES ('Double', 150.00, 'booked');
INSERT INTO Rooms (room_type, price_per_night, status)
VALUES ('Suite', 300.00, 'available');
INSERT INTO Rooms (room_type, price_per_night, status)
VALUES ('Single', 110.00, 'booked');
INSERT INTO Rooms (room_type, price_per_night, status)
VALUES ('Double', 160.00, 'available');

select * from Rooms;

INSERT INTO Reservations (customer_id, check_in_date, check_out_date)
VALUES (1, TO_DATE('2024-12-20', 'YYYY-MM-DD'), TO_DATE('2024-12-25', 'YYYY-MM-DD'));
INSERT INTO Reservations (customer_id, check_in_date, check_out_date)
VALUES (2, TO_DATE('2024-12-22', 'YYYY-MM-DD'), TO_DATE('2024-12-24', 'YYYY-MM-DD'));
INSERT INTO Reservations (customer_id, check_in_date, check_out_date)
VALUES (3, TO_DATE('2024-12-10', 'YYYY-MM-DD'), TO_DATE('2024-12-15', 'YYYY-MM-DD'));
INSERT INTO Reservations (customer_id, check_in_date, check_out_date)
VALUES (4, TO_DATE('2024-12-18', 'YYYY-MM-DD'), TO_DATE('2024-12-22', 'YYYY-MM-DD'));
INSERT INTO Reservations (customer_id, check_in_date, check_out_date)
VALUES (5, TO_DATE('2024-12-25', 'YYYY-MM-DD'), TO_DATE('2024-12-28', 'YYYY-MM-DD'));

select * from Reservations;

INSERT INTO Employees (first_name, last_name, position, phone_number)
VALUES ('Alice', 'Brown', 'Receptionist', '555-987654');
INSERT INTO Employees (first_name, last_name, position, phone_number)
VALUES ('Bob', 'Green', 'Cleaner', '555-123789');
INSERT INTO Employees (first_name, last_name, position, phone_number)
VALUES ('Charlie', 'White', 'Manager', '555-246810');
INSERT INTO Employees (first_name, last_name, position, phone_number)
VALUES ('Dana', 'Black', 'Housekeeper', '555-369258');
INSERT INTO Employees (first_name, last_name, position, phone_number)
VALUES ('Eve', 'Blue', 'Chef', '555-741852');

select * from Employees;

INSERT INTO Payments (reservation_id, amount, payment_date)
VALUES (1, 500.00, TO_DATE('2024-12-20', 'YYYY-MM-DD'));
INSERT INTO Payments (reservation_id, amount, payment_date)
VALUES (2, 300.00, TO_DATE('2024-12-22', 'YYYY-MM-DD'));
INSERT INTO Payments (reservation_id, amount, payment_date)
VALUES (3, 600.00, TO_DATE('2024-12-10', 'YYYY-MM-DD'));
INSERT INTO Payments (reservation_id, amount, payment_date)
VALUES (4, 500.00, TO_DATE('2024-12-18', 'YYYY-MM-DD'));
INSERT INTO Payments (reservation_id, amount, payment_date)
VALUES (5, 450.00, TO_DATE('2024-12-25', 'YYYY-MM-DD'));

select * from Payments;

INSERT INTO Services (service_name, price)
VALUES ('Spa', 50.00);
INSERT INTO Services (service_name, price)
VALUES ('Room Service', 20.00);
INSERT INTO Services (service_name, price)
VALUES ('Laundry', 15.00);
INSERT INTO Services (service_name, price)
VALUES ('Massage', 80.00);
INSERT INTO Services (service_name, price)
VALUES ('Airport Shuttle', 40.00);

select * from Services;

INSERT INTO Reservation_Services (reservation_id, service_id, quantity)
VALUES (1, 1, 2);
INSERT INTO Reservation_Services (reservation_id, service_id, quantity)
VALUES (2, 2, 1);
INSERT INTO Reservation_Services (reservation_id, service_id, quantity)
VALUES (3, 3, 3);
INSERT INTO Reservation_Services (reservation_id, service_id, quantity)
VALUES (4, 4, 1);
INSERT INTO Reservation_Services (reservation_id, service_id, quantity)
VALUES (5, 5, 1);

select * from Reservation_Services;

INSERT INTO Check_In_Out (customer_id, room_id, check_in, check_out)
VALUES (1, 1, TO_DATE('2024-12-20', 'YYYY-MM-DD'), TO_DATE('2024-12-25', 'YYYY-MM-DD'));
INSERT INTO Check_In_Out (customer_id, room_id, check_in, check_out)
VALUES (2, 2, TO_DATE('2024-12-22', 'YYYY-MM-DD'), TO_DATE('2024-12-24', 'YYYY-MM-DD'));
INSERT INTO Check_In_Out (customer_id, room_id, check_in, check_out)
VALUES (3, 3, TO_DATE('2024-12-10', 'YYYY-MM-DD'), TO_DATE('2024-12-15', 'YYYY-MM-DD'));
INSERT INTO Check_In_Out (customer_id, room_id, check_in, check_out)
VALUES (4, 4, TO_DATE('2024-12-18', 'YYYY-MM-DD'), TO_DATE('2024-12-22', 'YYYY-MM-DD'));
INSERT INTO Check_In_Out (customer_id, room_id, check_in, check_out)
VALUES (5, 5, TO_DATE('2024-12-25', 'YYYY-MM-DD'), TO_DATE('2024-12-28', 'YYYY-MM-DD'));

INSERT INTO Reservation_History (reservation_id, status, update_date)
VALUES (1, 'booked', TO_DATE('2024-12-20', 'YYYY-MM-DD'));
INSERT INTO Reservation_History (reservation_id, status, update_date)
VALUES (2, 'completed', TO_DATE('2024-12-24', 'YYYY-MM-DD'));
INSERT INTO Reservation_History (reservation_id, status, update_date)
VALUES (3, 'canceled', TO_DATE('2024-12-12', 'YYYY-MM-DD'));
INSERT INTO Reservation_History (reservation_id, status, update_date)
VALUES (4, 'booked', TO_DATE('2024-12-18', 'YYYY-MM-DD'));
INSERT INTO Reservation_History (reservation_id, status, update_date)
VALUES (5, 'completed', TO_DATE('2024-12-26', 'YYYY-MM-DD'));

INSERT INTO Discounts (discount_code, discount_percentage, start_date, end_date)
VALUES ('WINTER10', 10.00, TO_DATE('2024-12-01', 'YYYY-MM-DD'), TO_DATE('2024-12-31', 'YYYY-MM-DD'));
INSERT INTO Discounts (discount_code, discount_percentage, start_date, end_date)
VALUES ('NEWYEAR20', 20.00, TO_DATE('2024-12-25', 'YYYY-MM-DD'), TO_DATE('2024-12-31', 'YYYY-MM-DD'));
INSERT INTO Discounts (discount_code, discount_percentage, start_date, end_date)
VALUES ('SPRING15', 15.00, TO_DATE('2025-03-01', 'YYYY-MM-DD'), TO_DATE('2025-03-31', 'YYYY-MM-DD'));
INSERT INTO Discounts (discount_code, discount_percentage, start_date, end_date)
VALUES ('SUMMER25', 25.00, TO_DATE('2025-06-01', 'YYYY-MM-DD'), TO_DATE('2025-06-30', 'YYYY-MM-DD'));
INSERT INTO Discounts (discount_code, discount_percentage, start_date, end_date)
VALUES ('AUTUMN5', 5.00, TO_DATE('2025-09-01', 'YYYY-MM-DD'), TO_DATE('2025-09-30', 'YYYY-MM-DD'));

INSERT INTO Room_Types (room_type_name, description, base_price)
VALUES ('Single', 'A single room with one bed', 100.00);
INSERT INTO Room_Types (room_type_name, description, base_price)
VALUES ('Double', 'A double room with two beds', 150.00);
INSERT INTO Room_Types (room_type_name, description, base_price)
VALUES ('Suite', 'A luxurious suite with a living area', 300.00);
INSERT INTO Room_Types (room_type_name, description, base_price)
VALUES ('Penthouse', 'A premium suite with a private terrace', 500.00);
INSERT INTO Room_Types (room_type_name, description, base_price)
VALUES ('Family', 'A family room with extra beds', 200.00);

INSERT INTO Stay_Duration (customer_id, room_id, check_in_date, check_out_date, total_days)
VALUES (3, 3, TO_DATE('2024-12-10', 'YYYY-MM-DD'), TO_DATE('2024-12-15', 'YYYY-MM-DD'), 5);
INSERT INTO Stay_Duration (customer_id, room_id, check_in_date, check_out_date, total_days)
VALUES (4, 4, TO_DATE('2024-12-18', 'YYYY-MM-DD'), TO_DATE('2024-12-22', 'YYYY-MM-DD'), 4);
INSERT INTO Stay_Duration (customer_id, room_id, check_in_date, check_out_date, total_days)
VALUES (5, 5, TO_DATE('2024-12-25', 'YYYY-MM-DD'), TO_DATE('2024-12-28', 'YYYY-MM-DD'), 3);


--Hər işçinin adı və vəzifəsi
select first_name, position
from Employees;


-- Müştərilərin qaldığı otağın tipi
select first_name, last_name, room_type
from Rooms
inner join Check_In_Out on Rooms.room_id = Check_In_Out.room_id
inner join Customers on Check_In_Out.customer_id = Customers.customer_id;


--Müştərilərin otelə girib-çıxdığı tarix
select concat(concat(first_name, ' '), last_name) as full_name, check_in, check_out
from Customers
inner join Check_In_Out on Customers.customer_id = Check_In_Out.customer_id;


--Otelə gələn müştərilər haqq;nda məlumat
select *
from Customers;


--Mövcud olan otaqların siyahısı
select * 
from Rooms 
where status = 'available';


--Otaqların qiymətləri
select * 
from Payments;


-- Airport Shuttle olan xidmətlər
select * 
from Reservation_Services
inner join Services on Reservation_Services.service_id = Services.service_id
where service_name = ('Airport Shuttle');


select *
from Payments
where payment_date between TO_DATE('2024-12-01', 'YYYY-MM-DD') and TO_DATE('2024-12-31', 'YYYY-MM-DD');


SELECT customer_id, room_id, check_in_date, check_out_date, total_days
FROM Stay_Duration
WHERE customer_id = 5;


select r.room_type, 
       count(cio.log_id) as number_of_reservations, 
       sum(r.price_per_night * (cio.check_out - cio.check_in)) as total_revenue
from Rooms r
join Check_In_Out cio on r.room_id = cio.room_id  
where cio.check_in between TO_DATE('2024-12-01', 'YYYY-MM-DD') and TO_DATE('2024-12-31', 'YYYY-MM-DD')
group by r.room_type;


select r.room_type,
       count(distinct cio.customer_id) as number_of_customers,
       MAX(p.amount) as highest_payment
from Rooms r
join Check_In_Out cio on r.room_id = cio.room_id  
join Customers c on cio.customer_id = c.customer_id 
join Reservations res on c.customer_id = res.customer_id 
join Payments p on res.reservation_id = p.reservation_id  
group by r.room_type;


select s.service_name, 
       SUM(r.quantity * s.price) as total_spent, 
       count(r.reservation_service_id) as service_count
from Reservation_Services r
join Services s on r.service_id = s.service_id
where r.reservation_id in (select reservation_id from Reservations where customer_id = 1)
group by s.service_name;


select c.first_name, c.last_name, 
       count(distinct r.service_id) as number_of_services_used, 
       SUM(p.amount) as total_payment
from Customers c
join Reservations res on c.customer_id = res.customer_id
join Reservation_Services r on res.reservation_id = r.reservation_id
join Payments p on res.reservation_id = p.reservation_id
group by c.first_name, c.last_name;


select s.service_name, 
       SUM(r.quantity * s.price) as total_revenue
from Reservation_Services r
join Services s on r.service_id = s.service_id
join Reservations res on r.reservation_id = res.reservation_id
where res.check_in_date between TO_DATE('2024-12-01', 'YYYY-MM-DD') and TO_DATE('2024-12-31', 'YYYY-MM-DD')
group by s.service_name;
